# Dependency Change Summary Template

This document defines the template structure for change summary reports generated by the dependency monitoring system.

## Summary Report Format

### Overview Section

```markdown
## Dependency Monitoring Summary

**Report Date**: {{report_date}}
**Repository**: {{owner}}/{{repo}}
**Manifest Version**: {{manifest_version}}
**Check Duration**: {{check_duration_ms}}ms

### Statistics

| Metric | Value |
|--------|-------|
| Dependencies Checked | {{dependencies_checked}} |
| Changes Detected | {{changes_detected}} |
| Issues Created | {{issues_created}} |
| API Rate Limit Remaining | {{rate_limit_remaining}} |
```

### Changes by Severity

```markdown
### Changes by Severity

üî¥ **Breaking Changes**: {{breaking_count}}
üü† **Major Changes**: {{major_count}}
üü¢ **Minor Changes**: {{minor_count}}
```

### Individual Change Entries

For each detected change, include:

```markdown
#### {{dependency_name}}

- **URL**: {{dependency_url}}
- **Type**: {{dependency_type}}
- **Access Method**: {{access_method}}
- **Change Type**: {{change_type}}
- **Severity**: {{severity}}
- **Previous Version**: {{old_version}}
- **New Version**: {{new_version}}
- **Issue**: #{{issue_number}}

**Summary**: {{change_summary}}

**Details**:
{{change_details}}
```

### Breaking Changes Detail

For breaking changes, include additional information:

```markdown
#### Breaking Change: {{dependency_name}}

‚ö†Ô∏è **Breaking changes detected:**

{{#each breaking_changes}}
- {{this}}
{{/each}}

**Migration Required**: {{migration_required}}

**Affected Files**:
{{#each affected_files}}
- `{{file}}` (line {{line}})
{{/each}}
```

## Issue Template Format

### Issue Title

```
[dependabit] {{dependency_name}}: {{severity}} change - {{change_summary_short}}
```

### Issue Body

```markdown
## Dependency Change Detected

**Dependency**: [{{dependency_name}}]({{dependency_url}})
**Type**: {{dependency_type}}
**Severity**: {{severity_badge}} {{severity}}

### Change Details

| Field | Previous | Current |
|-------|----------|---------|
| Version | {{old_version}} | {{new_version}} |
| State Hash | {{old_hash_short}} | {{new_hash_short}} |
| Last Checked | {{old_checked_at}} | {{new_checked_at}} |

### Summary

{{change_summary}}

### Details

{{change_details}}

{{#if breaking_changes}}
### ‚ö†Ô∏è Breaking Changes

{{#each breaking_changes}}
- {{this}}
{{/each}}
{{/if}}

### Referenced In

This dependency is referenced in the following locations:

{{#each references}}
- `{{file}}`{{#if line}} (line {{line}}){{/if}}{{#if context}}: `{{context}}`{{/if}}
{{/each}}

### Recommended Actions

{{#if is_breaking}}
1. Review the breaking changes above
2. Check if your code is affected
3. Plan migration before updating
{{else if is_major}}
1. Review the release notes
2. Test compatibility in development
3. Update when ready
{{else}}
1. Review changes if time permits
2. Generally safe to update
{{/if}}

---

*This issue was automatically created by [dependabit](https://github.com/pradeepmouli/dependabit)*
*Detected at: {{detected_at}}*
*Correlation ID: {{correlation_id}}*

{{#if feedback_prompt}}
### Feedback

Was this a meaningful change? Help us improve detection accuracy:
- Add label `true-positive` if this change is relevant
- Add label `false-positive` if this shouldn't have been flagged
{{/if}}
```

## JSON Report Format

For programmatic consumption:

```json
{
  "reportVersion": "1.0.0",
  "generatedAt": "{{report_date}}",
  "repository": {
    "owner": "{{owner}}",
    "name": "{{repo}}"
  },
  "summary": {
    "dependenciesChecked": {{dependencies_checked}},
    "changesDetected": {{changes_detected}},
    "issuesCreated": {{issues_created}},
    "checkDurationMs": {{check_duration_ms}}
  },
  "changesBySeverity": {
    "breaking": {{breaking_count}},
    "major": {{major_count}},
    "minor": {{minor_count}}
  },
  "changes": [
    {
      "dependencyId": "{{dependency_id}}",
      "dependencyName": "{{dependency_name}}",
      "dependencyUrl": "{{dependency_url}}",
      "changeType": "{{change_type}}",
      "severity": "{{severity}}",
      "oldVersion": "{{old_version}}",
      "newVersion": "{{new_version}}",
      "summary": "{{change_summary}}",
      "issueNumber": {{issue_number}},
      "issueUrl": "{{issue_url}}"
    }
  ],
  "metadata": {
    "manifestVersion": "{{manifest_version}}",
    "correlationId": "{{correlation_id}}",
    "rateLimitRemaining": {{rate_limit_remaining}}
  }
}
```

## Template Variables Reference

| Variable | Type | Description |
|----------|------|-------------|
| `report_date` | ISO 8601 string | When the report was generated |
| `owner` | string | Repository owner |
| `repo` | string | Repository name |
| `manifest_version` | string | Version of the manifest schema |
| `check_duration_ms` | number | Total check duration in milliseconds |
| `dependencies_checked` | number | Count of dependencies checked |
| `changes_detected` | number | Count of changes found |
| `issues_created` | number | Count of issues created |
| `rate_limit_remaining` | number | GitHub API rate limit remaining |
| `breaking_count` | number | Count of breaking changes |
| `major_count` | number | Count of major changes |
| `minor_count` | number | Count of minor changes |
| `dependency_id` | UUID | Unique dependency identifier |
| `dependency_name` | string | Human-readable dependency name |
| `dependency_url` | URL | Dependency source URL |
| `dependency_type` | string | Type (schema, documentation, etc.) |
| `access_method` | string | How dependency is checked |
| `change_type` | string | Type of change detected |
| `severity` | string | breaking/major/minor |
| `severity_badge` | string | Emoji badge for severity |
| `old_version` | string | Previous version |
| `new_version` | string | Current version |
| `old_hash_short` | string | Previous state hash (truncated) |
| `new_hash_short` | string | Current state hash (truncated) |
| `change_summary` | string | Brief change description |
| `change_details` | string | Detailed change information |
| `breaking_changes` | array | List of breaking change descriptions |
| `references` | array | Files referencing this dependency |
| `issue_number` | number | Created issue number |
| `issue_url` | URL | Created issue URL |
| `correlation_id` | string | Tracking ID for this check run |
| `detected_at` | ISO 8601 string | When change was detected |
